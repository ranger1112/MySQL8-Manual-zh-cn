##  10.1 优化概述

在数据库级别也存在着一些因素影响着数据的性能，比如：数据表、查询、数据库配置。这些软件结构将影响 CPU 硬件级别的 I/O 操作，而我们要做的就是尽可能的将这些影响降到最小。当你想要提高数据库性能的时候，你首先需要深入了解的是数据库在软件方面的使用规则，并通过时间来衡量性能。而当你想要成为一个专家时，你则需要更多的了解软件内部是怎么运作的，并通过 CPU 运行周期和 I/O 操作之类的方面来衡量性能。


大多数用户的目的都是在现有的软件和硬件配置下追求最好的数据库性能。而资深用户会想要通过改变 MySQL 来提高性能，亦或是通过开发自己的存储引擎和硬件应用来扩展 MySQL 生态。

- 在数据库级别进行优化
- 在硬件级别进行优化
- 在可移植性和性能之间进行平衡

## 在数据库级别进行优化

保证数据库高性能最重要的因素就是其基本设计：
+ 数据表结构设计是否合理？通常需要考虑：字段是否使用了正确的数据类型？数据表的字段设计是否合理(是否包含了不该出现的字段, 这里应该是水平分表的意思)？比如，对于频繁更新数据的应用来说大多通过分散表来分散字段，也就是将表很多而每张表的字段比较少；而对于分析数据类的应用大多是表很少而每张表的字段很多(读多写少)。
+ 是否使用合适的 [索引](10.03_优化和索引.md) 以提高查询效率？
+ 是否为每张表使用了合适的存储引擎，并且充分利用了对于存储引擎的优势和特性？对于性能和可扩展性来说，选择事务性存储引擎（例如 [InnoDB](10.05_优化InnoDB表.md)），还是非事务性存储引擎（例如 [MyISAM](10.06_优化MyISAM表.md)） 是非常重要的。
+ 每张表是否使用合适的行结构？行结构的选择通常也取决于存储引擎的选择。通常来讲，压缩表使用更少的磁盘空间，因此也更适用于 I/O 读写比较少的场景。对于 InnoDB 表和 MyISAM 只读表来说，都是支持压缩的。
+ 应用程序是否使用了合适的 [锁定策略](10.11_优化锁定操作.md)？一般来说，为了保证数据操作可以并发运行，应该尽可能的允许共享访问。并在适当时请求独占访问，从而保证关键操作可以获得最高的优先级。此外，存储引擎的选择也相当重要。InnoDB 存储引擎不需要你的参与就可以解决大多数锁引发的问题，且 InnoDB 存储引擎在为数据库提供了更好的并发性的同时也减少了大量的 SQL 代码测试和优化工作。
+ 用于缓存的内存占用是否合适？一般来说，缓存占用大小应该满足足够容纳经常访问的数据，但又不能太大以至于其会导致物理内存溢出从而产生分页。最主要的内存大小配置就是 [InnoDB 缓冲池 和 MyISAM 健缓存](10.10_缓冲和缓存.md)。

> 注意：
> 
> InnoDB 是 MySQL 的默认存储引擎。在生产实践中，InnoDB 的性能表现大多数时候是优于使用更简单的 MyISAM 存储引擎的表的，尤其是对于读写频繁的系统。

## 在硬件级别进行优化

当数据库变得越来越繁忙时，任何数据库应用程序最终都会受到硬件性能的限制。此时 DBA 必须评估决定是调整应用程序、还是重新配置服务器去避免这些性能瓶颈，亦或是需要更多的硬件资源支持。系统性能瓶颈的常见风险有以下来源：
+ **磁盘查找**：磁盘查找一块数据是需要时间的，对于现在的磁盘来说，通常一次查找的时间是小于 10ms 的，所以理论上我们可以再一秒钟内执行 100 次查找。 这个情况随着磁盘技术的慢慢发展而缓慢改善，但是对于单表来说依然是很难去优化的。常见的磁盘优化方法是将数据分不到多个磁盘上。
+ **磁盘读写**：当我们知道了一个磁盘的确切地址时，我们通常需要对其进行读写操作。对于现代磁盘来说，一个磁盘至少提供 10-20MB/s 的吞吐量。磁盘读写比磁盘查找更容易优化，因为可以从多个磁盘并行读取。(这里的读写应该是一个连贯操作，也就是先读后写，而不是独立的读和写)。
+ **CPU生命周期**：通常我们需要处理主内存中的数据以得到我们预期的数据结结果。对于内存来说，大表一般是最常见的限制因素。但对于小表来说，速度通常不是问题。
+ **内存带宽**：当 CPU 需要的数据量超出 CPU 的缓存容量时，内存带宽就会成为性能瓶颈。对于大多数系统来说这并不是一个常见的瓶颈，但依然值得注意。

> 为什么将数据分散到多个磁盘可以优化磁盘寻址时间？
> 
> 1. 并行访问：多个磁盘可以同时进行读写操作，从而减少单个磁盘的负担。
> 2. 减少寻址移动：当数据分散存储在多个磁盘时，读写头在各个磁盘之间的移动可以更有效率，从而减少整体寻址时间。

## 在可移植性和性能之间进行平衡

当你需要在可移植的 MySQL 项目中使用针对性能的 SQL 扩展时，你可以将特定的 MySQL 关键字包裹在 `/*! */` 注释分隔符中。这样其他的 SQL Server 就会忽略这些关键字，从而不会影响性能。关于注释相关的信息，请参考 [第 11.7 节 “注释”](../11_语言结构/11.07_注释.md)。


***

[上一节: 10.00 优化](10.00_优化.md)

[本章目录](10.00_优化.md)

[下一节: 10.02 优化SQL语句](10.02.00_优化SQL语句.md)